<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>MnistUi</title>

    <!-- Vue -->
    <script src="node_modules/vue/dist/vue.min.js"></script>

    <!-- jQuery -->
    <script src="node_modules/jquery/dist/jquery.min.js"></script>
    <script>
        var $ = require('jquery')
    </script>

    <!-- font -->
    <link rel="stylesheet" href="node_modules/font-awesome/css/font-awesome.min.css">

    <!-- bulma -->
    <link rel="stylesheet" href="node_modules/bulma/css/bulma.css">

    <!-- ipc -->
    <script>
        const ipcRenderer = require('electron').ipcRenderer;
        ipcRenderer.on('inimg-reply', function (event, arg) {
            console.log(arg);
        });
    </script>
</head>
<body lang="zh-cn">
    <!--title -->
    <section class="hero is-link">
        <div class="hero-body">
            <div class="container">
                <div class="columns is-vcentered">
                    <div class="column">
                        <p class="title">
                            手写数字识别
                        </p>
                        <p class="subtitle">
                            Power by <strong>TensorFLow</strong>.这里想办法多写一点，不然不好看。
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- nav -->
    <nav class="navbar has-shadow">
        <div class="container">
            <div class="navbar-tabs">
                <a class="navbar-item is-tab" href="index.html">
                    欢迎
                </a>
                <a class="navbar-item is-tab is-active" href="canvas.html">
                    画板
                </a>
                <a class="navbar-item is-tab " href="camera.html">
                    摄像头
                </a>
                <a class="navbar-item is-tab" href="about.html">
                    关于
                </a>
            </div>
        </div>
    </nav>

    <!-- body -->
    <section class="section">
        <div class="columns">
            <div class="column is-two-thirds" id="mnist-image-column">
                <section class="hero is-link" >
                    <canvas class="image" id="mnist-image"></canvas>
                </section>
            </div>
            <div class="column">
                <div class="media-content bd-structure-item bd-is-structure-right">
                    <p>canvas input:</p>
                    <div align="center">
                        <figure class="image is-128x128">
                            <img id="inimg" src="res/128x128.png">
                        </figure>
                    </div>
                </div>
                <div class="media-content bd-structure-item bd-is-structure-right">
                    <p>preprocessing output:</p>
                    <div align="center">
                        <figure class="image is-128x128">
                            <img id="preimg" src="res/128x128.png">
                        </figure>
                    </div>
                </div>
                <div class="media-content bd-structure-item bd-is-structure-right">
                    <p>TensorFlow output:</p>
                    <div align="center">
                        </p><h1 class="title" id="vanswer">{{answer}}</h1></p>
                    </div>
                </div>
                <div align="center">
                    <div class="button is-link is-large" id="verify" onclick="verifyNum()">识 别 数 字</div></p>
                    <a class="button is-danger is-outlined" onclick="context.clearRect(0,0,1000,1000)">
                        <span>清除</span>
                        <span class="icon is-small">
                            <i class="fa fa-times"></i>
                        </span>
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- canvas -->
    <script>
        //get canvas
        var canvas = document.getElementById("mnist-image")
        if (canvas == null)
            console.log('canvas init failed!')

        //set canvas resize on window size change
        window.onresize = function () {
            var canvasColumn = document.getElementById("mnist-image-column")
            canvas.width = canvasColumn.clientWidth;
            canvas.height = canvasColumn.clientHeight;
        }
        //resize to show
        window.onresize()

        //set draw status
        var drable = false;
        canvas.onmousedown = function () { drable = true }
        canvas.onmouseup = function () { drable = false }

        //draw
        canvas.onmousemove = function (e) {
            if (drable) {
                context.fillRect(e.layerX, e.layerY, 20, 20)
            }
        }

        //clear
        function clearConvas() {
            context.clearConvas();
        }

        var context = canvas.getContext('2d');
    </script>

    <!-- navs -->
    <script>

    </script>

    <!-- canvas input -->

    <!-- pre processing output -->

    <!-- tf answer -->
    <script>
        var vAnswer = new Vue({
            el: '#vanswer',
            data: {
                answer: 0
            }
        })
    </script>

    <!-- verify -->
    <script>
        function verifyNum() {
            // todo:
            //start verify
            $('#verify')[0].onclick = null;
            $('#verify')[0].classList.add('is-loading')
            //show in img
            $('#inimg')[0].src = canvas.toDataURL("image/png");
            ipcRenderer.send('inimg', canvas.toDataURL("image/png"));
            //show pre img

            //show answer
            vAnswer.answer++//fortest

            //finish
            //$('#verify')[0].classList.remove('is-loading')
        }
    </script>

    <!-- footer -->
    <footer class="footer">
        <div class="container">
            <div class="content has-text-centered">
                <p>
                    <strong>MnistUi</strong> by <a href="http://jgthms.com">FeiLong</a>.
                </p>
            </div>
        </div>
    </footer>
</body>
</html>
